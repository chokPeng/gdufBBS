<?xml version="1.0" encoding="UTF-8" ?><!DOCTYPE mapper        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"><mapper namespace="com.robben.bbs.mapper.OrdinaryUserMapper">    <resultMap id="idAndPasswordAndAuthorities"               type="com.robben.bbs.pojo.OrdinaryUser">        <id column="userId" property="userId"></id>        <result column="password" property="password"></result>        <collection column="userId" property="authorities"                    select="com.robben.bbs.mapper.OrdinaryUserMapper.getAuthoritiesByUserId">        </collection>    </resultMap>    <!--通用的ordinary信息-->    <resultMap id="commonInfo" type="com.robben.bbs.pojo.OrdinaryUser">        <id column="userId" property="userId"></id>        <result column="username" property="username"></result>        <result column="avatar" property="avatar"></result>        <result column="level" property="level"></result>        <result column="location" property="location"></result>        <result column="sex" property="sex"></result>        <result column="introduction" property="introduction"></result>        <result column="phoneNumber" property="phoneNumber"></result>        <result column="joinTime" property="joinTime"></result>        <result column="email" property="email"></result>        <association property="followerNumber" column="userId"                     select="com.robben.bbs.mapper.RelationshipMapper.getFollowerNumber">        </association>        <association property="followeeNumber" column="userId"                     select="com.robben.bbs.mapper.RelationshipMapper.getFolloweeNumber">        </association>    </resultMap>    <resultMap id="userNumberAndAvatar" type="com.robben.bbs.pojo.OrdinaryUser">        <id column="userId" property="userId"></id>        <result column="userNumber" property="userNumber"></result>        <result column="avatar" property="avatar"></result>    </resultMap>    <select id="getAuthoritiesByUserId" parameterType="java.lang.Long"            resultType="org.springframework.security.core.authority.SimpleGrantedAuthority">        select role from authorities where userId=#{userId}    </select>    <select id="queryByUsername"            resultMap="idAndPasswordAndAuthorities">        select o.password,o.userId from ordinaryUser o where userId=#{username}    </select>    <select id="getUserNumberAndAvatarByUserId" resultMap="userNumberAndAvatar">        select userId,avatar,userNumber from ordinaryUser where userId=#{userId}    </select>    <select id="getUserById" parameterType="java.lang.Long" resultMap="commonInfo">        select userId,username,avatar,level,sex,location,email,introduction,joinTime,phoneNumber        from ordinaryUser where userId=#{userId}    </select>    <insert id="saveUser" parameterType="com.robben.bbs.pojo.OrdinaryUser">        insert into ordinaryUser(username,password,userId,phoneNumber) values(#{username},#{password},#{userId},#{phoneNumber})    </insert>    <update id="updateUser" parameterType="com.robben.bbs.pojo.OrdinaryUser">        update ordinaryUser set        <trim suffixOverrides=",">            <if test="username!='' and username!=null">                username=#{username},            </if>            <if test="avatar!='' and avatar!=null">                avatar=#{avatar},            </if>            <if test="level!=null and level!=''">                level=#{level},            </if>            <if test="location!=null and location!=''">                location=#{location},            </if>            <if test="sex!=null  and sex!=''">                sex=#{sex},            </if>            <if test="introduction!=null and introduction!=''">                introduction=#{introduction},            </if>            <if test="email!=null and email!=''">                email=#{email},            </if>            <if test="phoneNumber!=null and phoneNumber!=''">                phoneNumber=#{phoneNumber},            </if>        </trim>        where userId=#{userId}    </update>    <select id="getUserAvatar" resultType="java.lang.String">        select avatar from ordinaryUser where userId=#{userId}    </select>    <select id="queryUser" resultMap="commonInfo">        select userId,username,avatar,level,sex,location,email,introduction,joinTime,phoneNumber from ordinaryUser        where (username like concat('%',#{usernameOrUserId},'%')) or (userId=#{usernameOrUserId})    </select>    <select id="getUserNumber" resultType="java.lang.Integer">        select userNumber from ordinaryUser where userId=#{userId}    </select>    <select id="getUserRole" resultType="java.lang.Integer">        select count(userId) from authorities where userId=#{userId} and role='ROLE_admin'    </select></mapper>